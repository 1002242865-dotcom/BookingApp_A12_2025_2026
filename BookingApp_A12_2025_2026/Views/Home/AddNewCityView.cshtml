@model BookingApp_A12_2025_2026.Models.City
@{
}
<h1>Welcome to Add new city Form</h1>

@{
    ViewData["Title"] = "إضافة مدينة جديدة";
}

<div class="container mt-5" dir="rtl">
    <div class="card shadow-lg border-0 rounded-4 mx-auto" style="max-width: 900px;">
        <div class="card-header bg-success text-white text-center fs-4 rounded-top-4">
            🏙️ إضافة مدينة جديدة مع تحديد الموقع على الخريطة
        </div>

        <div class="card-body bg-light">
            <form asp-action="DoAddNewCity" asp-controller="Home" method="post" enctype="multipart/form-data">

                <!-- اسم المدينة -->
                <div class="mb-3">
                    <label for="City_Name" class="form-label fw-bold">اسم المدينة:</label>
                    <input type="text" id="City_Name" name="City_Name" asp-for="City_Name" class="form-control" required
                           placeholder="أدخل اسم المدينة (مثل: القدس)" />
                </div>

                <!-- خريطة Google لتحديد الموقع -->
                <div class="mb-3">
                    <label class="form-label fw-bold">حدد موقع المدينة على الخريطة:</label>
                    <div id="map" style="height: 400px; border-radius: 10px; border: 2px solid #198754;"></div>
                    <div class="form-text text-muted">انقر على الخريطة لتحديد موقع المدينة، وسيتم تعبئة الإحداثيات تلقائيًا.</div>
                </div>

                <!-- إحداثيات الموقع -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="lat" class="form-label fw-bold">خط العرض (Latitude):</label>
                        <input type="text" id="lat" name="City_Lat" asp-for="City_Lat" class="form-control" readonly />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="lng" class="form-label fw-bold">خط الطول (Longitude):</label>
                        <input type="text" id="lng" name="City_Lng" asp-for="City_Lng" class="form-control" readonly />
                    </div>
                </div>

                <!-- صورة المدينة -->
                <div class="mb-3">
                    <label for="City_Photo" class="form-label fw-bold">صورة المدينة:</label>
                    <input type="file" id="City_Photo" name="City_Photo_File"  class="form-control" accept="image/*" />
                </div>

                <!-- فيديو يوتيوب -->
                <div class="mb-3">
                    <label for="City_Video" class="form-label fw-bold">رمز فيديو يوتيوب:</label>
                    <input type="text" id="City_Video" name="City_Video" asp-for="City_Video" class="form-control"
                           placeholder="مثل: dQw4w9WgXcQ" />
                </div>

                <!-- المدينة آمنة -->
                <div class="form-check form-switch mb-3 text-end">
                    <input type="checkbox" id="City_IsSafe" name="City_IsSafe" asp-for="City_IsSafe" class="form-check-input" />
                    <label for="City_IsSafe" class="form-check-label fw-bold">المدينة آمنة</label>
                </div>

                <!-- وصف المدينة -->
                <div class="mb-3">
                    <label for="City_Description" class="form-label fw-bold">وصف المدينة:</label>
                    <textarea id="City_Description" name="City_Description" asp-for="City_Description" rows="4" class="form-control"
                              placeholder="اكتب معلومات عن المدينة..."></textarea>
                </div>

                <!-- زر الحفظ -->
                <div class="text-center">
                    <button type="submit" class="btn btn-success px-5 py-2 fs-5 rounded-3 shadow-sm">
                        💾 حفظ المدينة
                    </button>
                    <a href="/Home/ShowCities" class="btn btn-outline-secondary ms-3 px-4">
                        🔙 عودة إلى القائمة
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ✅ كود JavaScript لتفعيل الخريطة -->
<script>
    let map;
    let marker;

    function initMap() {
        // إعداد الموقع الافتراضي (القدس)
        const defaultLocation = { lat: 31.7683, lng: 35.2137 };

        map = new google.maps.Map(document.getElementById("map"), {
            center: defaultLocation,
            zoom: 8,
        });

        marker = new google.maps.Marker({
            position: defaultLocation,
            map: map,
            draggable: true,
        });

        // عند النقر على الخريطة
        map.addListener("click", (e) => {
            const lat = e.latLng.lat();
            const lng = e.latLng.lng();
            placeMarker(lat, lng);
        });

        // عند سحب العلامة
        marker.addListener("dragend", () => {
            const lat = marker.getPosition().lat();
            const lng = marker.getPosition().lng();
            updateInputs(lat, lng);
        });
    }

    function placeMarker(lat, lng) {
        marker.setPosition({ lat, lng });
        updateInputs(lat, lng);
    }

    function updateInputs(lat, lng) {
        document.getElementById("lat").value = lat.toFixed(6);
        document.getElementById("lng").value = lng.toFixed(6);
    }
</script>

<!-- 🔑 تضمين مكتبة Google Maps -->
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADwv4_84UrXKJhUov_hmys7CXLeBcOGM0&callback=initMap">
</script>
